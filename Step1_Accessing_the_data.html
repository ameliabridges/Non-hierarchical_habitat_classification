<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Amelia E.H. Bridges et al.">

<title>A guide to developing non-hierarchical habitat classifications using open-source data and software: Accessing the data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Step1_Accessing_the_data_files/libs/clipboard/clipboard.min.js"></script>
<script src="Step1_Accessing_the_data_files/libs/quarto-html/quarto.js"></script>
<script src="Step1_Accessing_the_data_files/libs/quarto-html/popper.min.js"></script>
<script src="Step1_Accessing_the_data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Step1_Accessing_the_data_files/libs/quarto-html/anchor.min.js"></script>
<link href="Step1_Accessing_the_data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Step1_Accessing_the_data_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Step1_Accessing_the_data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Step1_Accessing_the_data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Step1_Accessing_the_data_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A guide to developing non-hierarchical habitat classifications using open-source data and software: Accessing the data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Amelia E.H. Bridges et al. </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="an-introduction-to-this-document" class="level1">
<h1>An introduction to this document</h1>
<p>This document was developed as part of a pipeline to assist delegates of the ‘Habitat Conservation and Marine Spatial Planning’ workshop at the Deep Ocean Collective Solution Accelerator Meeting (Scripps Institution of Oceanography 2-5th October 2023) in developing regional benthic habitat classifications. The pipeline mirrors that used in <a href="https://www.sciencedirect.com/science/article/pii/S0079661123000599?via%3Dihub">McQuaid et al.&nbsp;(2023)</a>.</p>
<p>The <a href="XXX">repository</a> is designed to be downloaded as a zip folder and for the scripts to be run sequentially (steps 1 to 3) in the same R Studio session. This document is <em>not</em> designed to provide a thorough background in the theory of non-hierarchical habitat classification, nor the variable selection process. For this, we recommend reading <a href="https://www.sciencedirect.com/science/article/pii/S0079661123000599?via%3Dihub#bb0400">Howell (2010)</a> or the abovementioned McQuaid <em>et al.</em> (2023).</p>
<p>Should you notice any issues with the code or have any questions, please contact Dr Amelia Bridges at the University of Plymouth <a href="amelia.bridges@plymouth.ac.uk">amelia.bridges@plymouth.ac.uk</a>.</p>
</section>
<section id="prepare-your-folder-structure-working-environment" class="level1">
<h1>Prepare your folder structure &amp; working environment</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sdmpredictors)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MultiscaleDTM)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ensuring consistent structures/naming conventions conventions for folder and files is a good data management practice and will save you time (and headaches!) in the future.</p>
<p>Your working directory (wd) should be the folder you’ve downloaded from this GitHub repository where the .Rproj file is located. You can check this by running getwd().</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>wd<span class="ot">&lt;-</span><span class="fu">getwd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You’ll notice there are other subfolders so for ease, let’s create paths to them too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>raw_input_layers_folder<span class="ot">&lt;-</span><span class="fu">paste0</span>(wd, <span class="st">"/InputLayers/Unprocessed"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>clust_input_layers_folder<span class="ot">&lt;-</span><span class="fu">paste0</span>(wd, <span class="st">"/InputLayers"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>output_layers_folder<span class="ot">&lt;-</span><span class="fu">paste0</span>(wd, <span class="st">"/OutputLayers"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>results_folder<span class="ot">&lt;-</span><span class="fu">paste0</span>(wd, <span class="st">"/Results"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>my_plot_theme <span class="ot">&lt;-</span> <span class="cf">function</span>(...){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.line =</span> ggplot2<span class="sc">::</span><span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey50"</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">angle=</span><span class="dv">90</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">linewidth=</span><span class="dv">1</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>,<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">legend.text.align =</span> <span class="fl">0.5</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">legend.title.align =</span> <span class="dv">0</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>,<span class="at">vjust=</span><span class="fl">0.5</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                   ...)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="read-in-the-data" class="level1">
<h1>Read in the data</h1>
<section id="topography" class="level2">
<h2 class="anchored" data-anchor-id="topography">Topography</h2>
<p>In an ideal world, we would have a global layer of substrate type given it’s known importance as a driver of community structure. Unfortunately, no such layer currently exists, and therefore we make use of proxies from topography.</p>
<p>In <a href="https://www.sciencedirect.com/science/article/pii/S0079661123000599?via%3Dihub#s0220">McQuaid et al.&nbsp;(2023)</a>, we used three topographic variables to create our ‘topography layer’ - these were slope, fine-scale bathymetric position index (FBPI) and broad-scale (BBPI).</p>
<p>These variables are derivatives of bathymetry (i.e.&nbsp;they can be calculated from bathymetry).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>bathy<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="fu">paste0</span>(raw_input_layers_folder, <span class="st">"/GEBCO2020_Depth_10km_WGS84.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You’ll notice that the rasters I’m bringing in are named in similar ways. I use a naming convention that ensures I know the source (the GEBCO 2020 grid), variable (depth), resolution (10km) and projection (WGS84), without having to open the file. When working in R, calling the object (in this case ‘bathy’) also allows us to quickly look at the details including what coordinate reference system (crs) it’s in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bathy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterLayer 
dimensions : 2161, 4320, 9335520  (nrow, ncol, ncell)
resolution : 0.08333333, 0.08333333  (x, y)
extent     : -180, 180, -90, 90.08333  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +datum=WGS84 +no_defs 
source     : GEBCO2020_Depth_10km_WGS84.tif 
names      : GEBCO2020_Depth_10km_WGS84 
values     : -10848, 0  (min, max)</code></pre>
</div>
</div>
<p>As <em>per</em> the above, our bathymetry raster is in WGS84. To calculate the bathymetric derivatives we want, we need our bathymetry in an equal-area projection where all cells on the grid are the same size.</p>
<p>There are hundreds of equal-area projections to choose from but we’re going to use Mollweide - <a href="https://desktop.arcgis.com/en/arcmap/latest/map/projections/mollweide.htm">this page</a> explains it’s limitations and advantages nicely. The proj4string for Mollweide is ‘+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>molproj<span class="ot">&lt;-</span><span class="st">"+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>bathy_MOL<span class="ot">&lt;-</span><span class="fu">projectRaster</span>(bathy, <span class="at">crs=</span>molproj, <span class="at">res=</span><span class="fu">c</span>(<span class="dv">10000</span>,<span class="dv">10000</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bathy_MOL, <span class="at">main=</span><span class="st">"Bathymetry (Mollweide)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/project-bathy-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can see from the map that this is in the Mollweide projection as opposed to the WGS84 version below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bathy, <span class="at">main=</span><span class="st">"Bathymetry (WGS84)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-bathy-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now we have out bathymetry data read in and in the correct projection, we need to calculate slope, FBPI and BBPI and we do this using the <a href="https://rdrr.io/github/ailich/MultiscaleDTM/">MultiscaleDTM</a> package described in <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/tgis.13067">Ilich et al.&nbsp;(2023)</a>.</p>
<section id="slope" class="level3">
<h3 class="anchored" data-anchor-id="slope">Slope</h3>
<p>Slope refers to the steepness or inclination of the seabed surface at a particular location. It quantifies how much the elevation of the seabed changes over a horizontal distance and is often measured in degrees. Slope is a useful topographic variable in this instance as it can be interpreted as a surrogate for hydrodynamic properties such as current velocity which in turn can be used to model substrate type and grain size (biologically relevant variables). For example, steep slopes are often washed by fast currents that strip away light sediment, exposing hard substrate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>slo<span class="ot">&lt;-</span><span class="fu">SlpAsp</span>(bathy_MOL, <span class="at">w=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">unit=</span><span class="st">"degrees"</span>, <span class="at">method=</span><span class="st">"queen"</span>, <span class="at">metrics=</span><span class="st">"slope"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>slo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterLayer 
dimensions : 1802, 3618, 6519636  (nrow, ncol, ncell)
resolution : 10000, 10000  (x, y)
extent     : -18089740, 18090260, -9073049, 8946951  (xmin, xmax, ymin, ymax)
crs        : +proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs 
source     : memory
names      : slope 
values     : 0, 18.44445  (min, max)</code></pre>
</div>
</div>
<p>This raster is in Mollweide but we want to make our classification in WGS84 - this is because in marine spatial planning, WGS84 is more commonly used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>wgsproj<span class="ot">&lt;-</span><span class="st">"+proj=longlat +datum=WGS84 +no_defs"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>slo<span class="ot">&lt;-</span><span class="fu">projectRaster</span>(slo, bathy, <span class="at">crs=</span>wgsproj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>R is brilliant for quickly automating tasks, but it’s still really important for us to ‘eyeball’ our data and ensure the input variables look correct. This is where expert opinion and knowing your study area is crucial.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(slo, <span class="at">main=</span><span class="st">"Slope"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-slope-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These values and the plot look as one would expect for a global slope map, with large ridge systems identified as well as flat abyssal plains.</p>
<p>Given the aim of this workshop is to provide skills in developing <strong>regional</strong> habitat classifications, we’re going to clip our rasters and work in the Gulf of Guinea. If we plot this clip, we see our slope values for our region of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>gog_shp<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">vect</span>(<span class="fu">paste0</span>(clust_input_layers_folder, <span class="st">"/Gulf_of_Guinea.shp"</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>slo<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">rast</span>(slo) <span class="co"># we convert into a SpatRaster format for the crop() function</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>slo<span class="ot">&lt;-</span><span class="fu">crop</span>(slo, gog_shp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note, whilst I made the Gulf of Guinea shapefile, there are plenty of R packages that contain national shapefiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(slo, <span class="at">main=</span><span class="st">"Slope: Gulf of Guinea"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-cropped-slope-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s save the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>slo<span class="ot">&lt;-</span><span class="fu">raster</span>(slo) <span class="co"># we convert into a SpatRaster format for the crop() function</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(slo, <span class="at">filename=</span>(<span class="fu">paste0</span>(raw_input_layers_folder, <span class="st">"/GEBCO2020_GoG_Slo_10km_WGS84.tif"</span>)), <span class="at">overwrite=</span><span class="cn">TRUE</span>, <span class="at">format=</span><span class="st">"GTiff"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="broad-scale-bathymetric-position-index-bbpi" class="level3">
<h3 class="anchored" data-anchor-id="broad-scale-bathymetric-position-index-bbpi">Broad-scale bathymetric position index (BBPI)</h3>
<p>Bathymetric position index refers to the elevation of a focal point (i.e.&nbsp;grid cell) in relation to the overall landscape (i.e.&nbsp;surrounding grid cells), where positive values represent raised areas and negative values are depressions. Relative height of the seabed is important as it can act as another surrogate for current velocity and substrate. Depending on the scale factor used, bathymetric position indices can be used to identify habitats over different scales such as meso- and megahabitats.</p>
<p>Scale factor is calculated by by multiplying the grid resolution (in this case 10 km) by the outer radius you specify when calculating. For this example, we’ll use the following values:</p>
<ul>
<li>FBPI: inner = 1, outer = 2
<ul>
<li>2 x 10 km = 20 km; identifying habitats at the tens of km scale</li>
</ul></li>
<li>BBPI: inner: 1, outer = 10
<ul>
<li>10 x 10 km = 100 km; identifying habitats at the hundreds of km scale</li>
</ul></li>
</ul>
<p>Note: the values of BPI are relative and not comparable across tools (e.g.&nbsp;if you make your layer in Arc <em>versus</em> R, there will likely be differences).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>specs<span class="ot">&lt;-</span><span class="fu">annulus_window</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>), <span class="st">"cell"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>bbpi<span class="ot">&lt;-</span>MultiscaleDTM<span class="sc">::</span><span class="fu">BPI</span>(bathy_MOL, <span class="at">w =</span> specs, <span class="at">unit =</span> <span class="st">"cell"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>bbpi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterLayer 
dimensions : 1802, 3618, 6519636  (nrow, ncol, ncell)
resolution : 10000, 10000  (x, y)
extent     : -18089740, 18090260, -9073049, 8946951  (xmin, xmax, ymin, ymax)
crs        : +proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs 
source     : memory
names      : bpi 
values     : -4455.167, 5074.362  (min, max)</code></pre>
</div>
</div>
<p>The values look sensible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>bbpi<span class="ot">&lt;-</span><span class="fu">projectRaster</span>(bbpi, bathy, <span class="at">crs=</span>wgsproj)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>bbpi<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">rast</span>(bbpi) <span class="co"># we convert into a SpatRaster format for the crop() function</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>bbpi<span class="ot">&lt;-</span><span class="fu">crop</span>(bbpi, gog_shp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bbpi, <span class="at">main=</span><span class="st">"BBPI: Gulf of Guinea"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-cropped-bbpi-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And so does the plot so we’ll save the layer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>bbpi<span class="ot">&lt;-</span><span class="fu">raster</span>(bbpi) <span class="co"># </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(bbpi, <span class="at">filename=</span>(<span class="fu">paste0</span>(raw_input_layers_folder, <span class="st">"/GEBCO2020_GoG_BBPI_10km_WGS84.tif"</span>)), <span class="at">overwrite=</span><span class="cn">TRUE</span>, <span class="at">format=</span><span class="st">"GTiff"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fine-scale-bathymetric-position-index-fbpi" class="level3">
<h3 class="anchored" data-anchor-id="fine-scale-bathymetric-position-index-fbpi">Fine-scale bathymetric position index (FBPI)</h3>
<p>See blurb above for FBPI description.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>specs<span class="ot">&lt;-</span><span class="fu">annulus_window</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="st">"cell"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fbpi<span class="ot">&lt;-</span>MultiscaleDTM<span class="sc">::</span><span class="fu">BPI</span>(bathy_MOL, <span class="at">w =</span> specs, <span class="at">unit =</span> <span class="st">"cell"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>fbpi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterLayer 
dimensions : 1802, 3618, 6519636  (nrow, ncol, ncell)
resolution : 10000, 10000  (x, y)
extent     : -18089740, 18090260, -9073049, 8946951  (xmin, xmax, ymin, ymax)
crs        : +proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs 
source     : memory
names      : bpi 
values     : -3248.836, 3691.62  (min, max)</code></pre>
</div>
</div>
<p>The values look sensible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fbpi<span class="ot">&lt;-</span><span class="fu">projectRaster</span>(fbpi, bathy, <span class="at">crs=</span>wgsproj)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fbpi<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">rast</span>(fbpi) <span class="co"># we convert into a SpatRaster format for the crop() function</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>fbpi<span class="ot">&lt;-</span><span class="fu">crop</span>(fbpi, gog_shp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fbpi, <span class="at">main=</span><span class="st">"FBPI: Gulf of Guinea"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-cropped-fbpi-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And so does the plot so we’ll save the layer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fbpi<span class="ot">&lt;-</span><span class="fu">raster</span>(fbpi) <span class="co"># </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(fbpi, <span class="at">filename=</span>(<span class="fu">paste0</span>(raw_input_layers_folder, <span class="st">"/GEBCO2020_GoG_FBPI_10km_WGS84.tif"</span>)), <span class="at">overwrite=</span><span class="cn">TRUE</span>, <span class="at">format=</span><span class="st">"GTiff"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="productivity" class="level2">
<h2 class="anchored" data-anchor-id="productivity">Productivity</h2>
<p>Food availability (in the form of particulate organic carbon (POC) flux to depth) is another well-known driver of biological distributions in offshore habitats given their sometimes food-limited nature. In this context, we term this ‘productivity’.</p>
<p>The productivity (POC flux to depth) layer we’re using comes from the NEMO-MEDUSA model. Authors have uploaded the netCDF version on Zenodo, <a href="https://zenodo.org/record/6513616#.Yn6TGx1BzIU">here</a>. However for ease, the TIFF version is in the ‘InputLayers’ folder of this repo. Let’s read it in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>prod<span class="ot">&lt;-</span><span class="fu">raster</span>(<span class="fu">paste0</span>(raw_input_layers_folder, <span class="st">"/Yool_POC_10km_WGS84.tif"</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prod, <span class="at">main=</span><span class="st">"POC flux to depth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/read-plot-prod-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Again, here you can see that (as expected) continental shelves have higher productivity and you can see the slight increases in productivity in temperate latitudes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>prod<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">rast</span>(prod) <span class="co"># we convert into a SpatRaster format for the crop() function</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>prod<span class="ot">&lt;-</span><span class="fu">crop</span>(prod, gog_shp)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prod, <span class="at">main=</span><span class="st">"POC flux to depth: Gulf of Guinea"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-cropped-prod-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>prod<span class="ot">&lt;-</span><span class="fu">raster</span>(prod)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(prod, <span class="at">filename=</span>(<span class="fu">paste0</span>(raw_input_layers_folder, <span class="st">"/Yool_GoG_POC_10km_WGS84.tif"</span>)), <span class="at">overwrite=</span><span class="cn">TRUE</span>, <span class="at">format=</span><span class="st">"GTiff"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="water-mass-structure" class="level2">
<h2 class="anchored" data-anchor-id="water-mass-structure">Water mass structure</h2>
<p>Some habitat classifications use depth in their models to distinguish between classes (habitats). However, depth is not the biologically relevant variable - it’s often a succinct way of summarizing water mass structure. Whilst this is suitable in some circumstances the depth that different water masses are found is regionally dependent, and therefore a one size fits all approach (e.g.&nbsp;“there’s a difference in communities above and below 300 m”) does not work.</p>
<p>Water mass structure is a function of temperature and salinity. Therefore, we will cluster these variables to identify different bottom water masses in our region of interest.</p>
<p>There are numerous repositories where you can download different datasets for various areas at various resolutions. Depending on your questions, some good examples include:</p>
<ul>
<li><a href="https://www.bio-oracle.org/">Bio-ORACLE</a></li>
<li><a href="https://www.worldclim.org/">WorldClim</a></li>
<li><a href="https://climate.esa.int/en/odp/#/dashboard">European Space Agency</a></li>
<li><a href="https://www.gmrt.org/index.php">Global Multi-Resolution Topography Data Synthesis (GMRT)</a></li>
<li><a href="https://www.naturalearthdata.com/">Natural Earth</a></li>
<li><a href="https://ohi-science.org/ohi-global/index.html">Ocean Health Index (OHI) global assessments</a></li>
</ul>
<p>Here, we use the sdmpredictors library that speaks to several databases to download the bottom temperature and salinity from Bio-ORACLE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sdm_datasets<span class="ot">&lt;-</span>sdmpredictors<span class="sc">::</span><span class="fu">list_datasets</span>(<span class="at">terrestrial =</span> <span class="cn">FALSE</span>, <span class="at">marine =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>layers<span class="ot">&lt;-</span>sdmpredictors<span class="sc">::</span><span class="fu">list_layers</span>(sdm_datasets)<span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(layer_url, <span class="st">'Present.Benthic.Mean.Depth'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(primary_spatial_resolution<span class="sc">==</span><span class="st">"0.25 arcdegree"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(version<span class="sc">==</span><span class="dv">22</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These are the 66 layers available from Bio-ORACLE (version 2.2) for which the values refer to present benthic conditions taken at the mean depth of each cell at a 0.25 arc degree resolution.</p>
<p>We want to download the latest version (BO22) of mean temperature and salinity (tempmean/salinitymean) for the mean bottom depth (bdmean).</p>
<section id="temperature" class="level3">
<h3 class="anchored" data-anchor-id="temperature">Temperature</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span><span class="fu">load_layers</span>(<span class="st">"BO22_tempmean_bdmean"</span>, <span class="at">equalarea=</span><span class="cn">FALSE</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>temp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterStack 
dimensions : 2160, 4320, 9331200, 1  (nrow, ncol, ncell, nlayers)
resolution : 0.08333333, 0.08333333  (x, y)
extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +datum=WGS84 +no_defs 
names      : BO22_tempmean_bdmean 
min values :            -1.839894 
max values :              31.4447 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp, <span class="at">main=</span><span class="st">"Bottom Temperature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-temp-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">rast</span>(temp) <span class="co"># we convert into a SpatRaster format for the crop() function</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span><span class="fu">crop</span>(temp, gog_shp)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp, <span class="at">main=</span><span class="st">"Bottom Temperature: Gulf of Guinea"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-cropped-temp-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span><span class="fu">raster</span>(temp)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(temp, <span class="at">filename=</span>(<span class="fu">paste0</span>(raw_input_layers_folder, <span class="st">"/BO_GoG_Temp_10km_WGS84.tif"</span>)), <span class="at">overwrite=</span><span class="cn">TRUE</span>, <span class="at">format=</span><span class="st">"GTiff"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="salinity" class="level3">
<h3 class="anchored" data-anchor-id="salinity">Salinity</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sal<span class="ot">&lt;-</span><span class="fu">load_layers</span>(<span class="st">"BO22_salinitymean_bdmean"</span>, <span class="at">equalarea =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>sal</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class      : RasterStack 
dimensions : 2160, 4320, 9331200, 1  (nrow, ncol, ncell, nlayers)
resolution : 0.08333333, 0.08333333  (x, y)
extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +datum=WGS84 +no_defs 
names      : BO22_salinitymean_bdmean 
min values :                 4.990345 
max values :                 40.75557 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sal, <span class="at">main=</span><span class="st">"Bottom Salinity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-sal-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>sal<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">rast</span>(sal) <span class="co"># we convert into a SpatRaster format for the crop() function</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>sal<span class="ot">&lt;-</span><span class="fu">crop</span>(sal, gog_shp)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sal, <span class="at">main=</span><span class="st">"Bottom Salinity: Gulf of Guinea"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Step1_Accessing_the_data_files/figure-html/plot-cropped-sal-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>sal<span class="ot">&lt;-</span><span class="fu">raster</span>(sal)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(sal, <span class="at">filename=</span>(<span class="fu">paste0</span>(raw_input_layers_folder, <span class="st">"/BO_GoG_Sal_10km_WGS84.tif"</span>)), <span class="at">overwrite=</span><span class="cn">TRUE</span>, <span class="at">format=</span><span class="st">"GTiff"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="biogeography" class="level2">
<h2 class="anchored" data-anchor-id="biogeography">Biogeography</h2>
<p>The final layer we need is biogeography to differentiate between two ‘unconnected’ areas with similar conditions (e.g.&nbsp;the Arctic and the Antarctic).</p>
<p>The datasets we’re using in this demonstrations are low-resolution, global layers. From a global biogeography perspective, the Gulf of Guinea falls entirely within one biogeographic region (e.g.&nbsp;all within the ‘Atlantic’ biogeographic region in our McQuaid <em>et al.</em> (2023) paper). Therefore for this example, we are not going to employ a biogeography layer.</p>
<p>However, were you to be working at a finer scale (and crucially with high-resolution data), you may want to consider employing a biogeography to differentiate between regions. There are plenty of published biogeographies at varying scales. Most of these are heavily influenced by water mass structure. However, the water mass structure boundaries used to develop other biogeographies will not align exactly with your water mass structure boundaries. This mismatch means that were you to import a published biography directly onto your classification, you will end up with high numbers of habitat classes around the ‘joins’ which might throw off your analysis.</p>
<p>To get around this in the McQuaid <em>et al.</em> (2023) paper, we followed the water mass boundaries from our clustered water mass structure input layer (you’ll make this in the step 2 script). For full details on how to develop a biogeography layer from a water mass structure input, please see the <a href="https://www.sciencedirect.com/science/article/pii/S0079661123000599?via%3Dihub">McQuaid <em>et al.</em> (2023) paper</a>.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>